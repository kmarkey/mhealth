theme_map() + labs(fill = "Percent", title = "Percentage of Respondents Who Had \n14+ Bad Mental Health Days",
caption = "Data provided by BRFSS") +
scale_fill_distiller(palette = "Spectral") +
theme(text = element_text(size = 10))
# add nmhss data
data <- n1 %>%
dplyr::select(name, TOT) %>%
distinct() %>%
left_join(us_states, by = c("name" = "region")) %>%
left_join(pop, by = c("name"))
q <- ggplot(data, aes(x = long, y = lat,
group = group, fill = TOT/pop)) +
coord_map(projection = "albers", lat0 = 39, lat1 = 45) +
geom_polygon(color = "#8d99ae", size = 0.1) +
theme_map() + labs(fill = "Rate", title = "Number of Mental Health Facilities per Capita",
caption = "Data provided by SAHMSA.gov") +
scale_fill_continuous(labels = comma) +
scale_fill_distiller(palette = "Spectral") +
theme(text = element_text(size = 10))
# for at least 1
data <- b1 %>%
group_by(name) %>%
summarise( per = sum(ifelse(ment14d != "0", 1, 0))/n()) %>%
distinct() %>%
right_join(us_states, by = c("name" = "region"))
r <- ggplot(data, aes(x = long, y = lat,
group = group, fill = per * 100)) +
coord_map(projection = "albers", lat0 = 39, lat1 = 45) +
geom_polygon(color = "#8d99ae", size = 0.1) +
theme_map() + labs(fill = "Percent", title = "Percentage of Respondents Who Had at \nLeast 1 Bad Mental Health Day",
caption = "Data provided by BRFSS") +
scale_fill_distiller(palette = "Spectral") +
theme(text = element_text(size = 10))
grid.arrange(p, q, r, nrow = 2)
# top 10 phd14+
phd14top <- b1 %>%
group_by(name) %>%
summarise(per = sum(ifelse(phys14d == "14+", 1, 0))/n(), rank = 1) %>%
distinct() %>%
arrange(desc(per)) %>%
head(10)
# bottom 10 phd14+
phd14bottom <- b1 %>%
group_by(name) %>%
summarise(per = sum(ifelse(phys14d == "14+", 1, 0))/n(), rank = 2) %>%
distinct() %>%
arrange(desc(per)) %>%
tail(10)
# plot together
bind_rows(phd14top, phd14bottom) %>%
ggplot() + geom_bar(aes(x = reorder(name, -per), y = per * 100, fill = rank), stat = "identity") +
guides(fill = "none") +
labs(x = "", y = "Peercent", title = "Percentage of Respondents Who Had 14+ Bad Physical Health Days",
subtitle = "By State", caption = "BRFSS") +
theme(axis.text.x = element_text(angle = 20))
# ############### not 0 days #############################################
#top 10 mhd 14+
mhd14top <- b1 %>%
group_by(name) %>%
summarise(per = sum(ifelse(ment14d != "0", 1, 0))/n(), rank = 1) %>%
distinct() %>%
arrange(desc(per)) %>%
head(10)
# bottom 10 mhd14+
mhd14bottom <- b1 %>%
group_by(name) %>%
summarise(per = sum(ifelse(ment14d != "0", 1, 0))/n(), rank = 2) %>%
distinct() %>%
arrange(desc(per)) %>%
tail(10)
#plot together
bind_rows(mhd14top, mhd14bottom) %>%
ggplot() + geom_bar(aes(x = reorder(name, -per), y = per * 100, fill = rank), stat = "identity") +
guides(fill = "none") +
labs(x = "", y = "Percent", title = "Percentage of Respondents Who Had More Than 0 Bad Mental Health Days",
subtitle = "By State", caption = "BRFSS") +
theme(axis.text.x = element_text(angle = 20))
# top 10 phd14+
phd14top <- b1 %>%
group_by(name) %>%
summarise(per = sum(ifelse(phys14d != "0", 1, 0))/n(), rank = 1) %>%
distinct() %>%
arrange(desc(per)) %>%
head(10)
# bottom 10 phd14+
phd14bottom <- b1 %>%
group_by(name) %>%
summarise(per = sum(ifelse(phys14d != "0", 1, 0))/n(), rank = 2) %>%
distinct() %>%
arrange(desc(per)) %>%
tail(10)
# plot together
bind_rows(phd14top, phd14bottom) %>%
ggplot() + geom_bar(aes(x = reorder(name, -per), y = per * 100, fill = rank), stat = "identity") +
guides(fill = "none") +
labs(x = "", y = "Peercent", title = "Percentage of Respondents Who Had 14+ Bad Physical Health Days",
subtitle = "By State", caption = "BRFSS") +
theme(axis.text.x = element_text(angle = 20))
# ############### not 0 days #############################################
#top 10 mhd 14+
mhdn0top <- b1 %>%
group_by(name) %>%
summarise(per = sum(ifelse(ment14d != "0", 1, 0))/n(), rank = 1) %>%
distinct() %>%
arrange(desc(per)) %>%
head(10)
# bottom 10 mhd14+
mhdn0bottom <- b1 %>%
group_by(name) %>%
summarise(per = sum(ifelse(ment14d != "0", 1, 0))/n(), rank = 2) %>%
distinct() %>%
arrange(desc(per)) %>%
tail(10)
#plot together
bind_rows(mhdn0top, mhdn0bottom) %>%
ggplot() + geom_bar(aes(x = reorder(name, -per), y = per * 100, fill = rank), stat = "identity") +
guides(fill = "none") +
labs(x = "", y = "Percent", title = "Percentage of Respondents Who Had At Least 1 Bad Mental Health Day",
subtitle = "By State", caption = "BRFSS") +
theme(axis.text.x = element_text(angle = 20))
# top 10 phd14+
phdn0top <- b1 %>%
group_by(name) %>%
summarise(per = sum(ifelse(phys14d != "0", 1, 0))/n(), rank = 1) %>%
distinct() %>%
arrange(desc(per)) %>%
head(10)
# bottom 10 phd14+
phdn0bottom <- b1 %>%
group_by(name) %>%
summarise(per = sum(ifelse(phys14d != "0", 1, 0))/n(), rank = 2) %>%
distinct() %>%
arrange(desc(per)) %>%
tail(10)
# plot together
bind_rows(phdn0top, phdn0bottom) %>%
ggplot() + geom_bar(aes(x = reorder(name, -per), y = per * 100, fill = rank), stat = "identity") +
guides(fill = "none") +
labs(x = "", y = "Peercent", title = "Percentage of Respondents Who Had At Least 1 Bad Physical Health Day",
subtitle = "By State", caption = "BRFSS") +
theme(axis.text.x = element_text(angle = 20))
#plot together
bind_rows(mhdn0top, mhdn0bottom) %>%
ggplot() + geom_bar(aes(x = reorder(name, -per), y = per * 100, fill = rank), stat = "identity") +
guides(fill = "none") +
labs(x = "", y = "Percent", title = "Percentage of Respondents Who Had \nAt Least 1 Bad Mental Health Day",
subtitle = "By State", caption = "BRFSS") +
theme(axis.text.x = element_text(angle = 20))
# plot together
bind_rows(phdn0top, phdn0bottom) %>%
ggplot() + geom_bar(aes(x = reorder(name, -per), y = per * 100, fill = rank), stat = "identity") +
guides(fill = "none") +
labs(x = "", y = "Peercent", title = "Percentage of Respondents Who Had \nAt Least 1 Bad Physical Health Day",
subtitle = "By State, Top 10 and Bottom 10", caption = "BRFSS") +
theme(axis.text.x = element_text(angle = 20))
#plot together
bind_rows(mhdn0top, mhdn0bottom) %>%
ggplot() + geom_bar(aes(x = reorder(name, -per), y = per * 100, fill = rank), stat = "identity") +
guides(fill = "none") +
labs(x = "", y = "Percent", title = "Percentage of Respondents Who Had \nAt Least 1 Bad Mental Health Day",
subtitle = "By State, Top 10 and Bottom 10", caption = "BRFSS") +
theme(axis.text.x = element_text(angle = 20))
gc()
#Please modify the chunk set up as you wish, some options are in # below
knitr::opts_chunk$set(fig.align = "center",
out.width = "90%",
out.height = "70%",
dpi = 600,
dev = 'png')
#Add packages
library(tidyverse)
library(cowplot)
library(ggridges)
library(kableExtra)
library(usmap)
library(corrplot)
library(readxl)
library(scales)
library(gridExtra)
library(ggrepel)
#Set universal theme + palette for figures
pal <- c("#f6aa1c","#08415c","#6b818c","#eee5e9","#ba7ba1","#c28cae","#a52a2a")
blue <- "#114482"
lightblue <- "#146ff8"
llightblue <- "#AFCFFF"
red <- "#a52a2a"
white <- "#FBFFF1"
yellow <- "#F6AA1C"
ljtheme <- function(){
theme_minimal() %+replace%
theme(
panel.grid.major = element_line(linetype = "solid", color = llightblue, size = 0.1),
panel.grid.minor = element_blank(),
panel.background = element_rect(fill = white), #light
panel.border = element_rect(color = lightblue, fill = NA, linetype = "solid", size = 2),
legend.background = element_rect(fill = white, color = lightblue, size = 1), # legend
legend.text = element_text(color = blue),
legend.title = element_text(face = "bold.italic", color = blue),
legend.position = "bottom",
legend.key = element_rect(fill = white),
text = element_text(color = white),
axis.title = element_text(face = "italic", size = 11, color = white),
axis.text = element_text(color = white, size = 9),
axis.ticks = element_line(color = white, size = .5, lineend = "butt"),
axis.ticks.length = unit(.1, "cm"),
plot.title = element_text(face = "bold", # labels
color = white, size = 14, hjust = 0, vjust = 1.5),
plot.subtitle = element_text(color = white, hjust = 0, vjust = 1.5, face = "italic"),
plot.caption = element_text(color = white, face = "bold", hjust = 1),
plot.background = element_rect(fill = blue),
strip.background = element_blank(),
strip.text = element_text())}
theme_set(ljtheme())
suppressWarnings(
source("digest.R", print.eval = FALSE))
# state
suppressWarnings(
source("agegroupjoin.R", print.eval = FALSE))
View(n1)
which(iris$Species  == "Setosa")
iris[,iris$Species  == "Setosa"]
data("iris")
iris[,iris$Species  == "Setosa"]
unique(iris$Species)
iris[,iris$Species  == "setosa"]
iris[iris$Species == "setosa",]
which(iris[,iris$Species  == "setosa"])
which(iris$Species  == "setosa")
source("~/LocalRStudio/mhealth352/digest.R", echo=TRUE)
View(b1)
View(n1)
source("~/LocalRStudio/mhealth352/digest.R", echo=TRUE)
setwd("LocalRStudio/mhealth352")
source("~/LocalRStudio/mhealth352/digest.R", echo=TRUE)
require(dplyr)
require(forcats)
require(readxl)
require(tidyr)
require(purrr)
require(rlang)
charlist <- c("X_INCOMG", "EMPLOY1")
b1 <- brfss %>%
dplyr::select(-date, -PHYSHLTH, -MENTHLTH, -POORHLTH, -health, -HTM4, -WTKG3) %>%
dplyr::mutate(age = fct_collapse(age, "18-64" = c("18-24", "25-34", "35-44", "45-54", "55-64"),
"65+" = c("65+")),
across(all_of(charlist), as.factor)) %>%
na.omit()
View(b1)
View(nmhss1)
nmhss2 <- left_join(nmhss1, statekey, by = c("LST" = "abb")) %>%
dplyr::select(-LST, -num)
# list of #yes# vars using purrr
yvar <- nmhss1 %>%
dplyr::select(where(~ "yes" %in% levels(.))) %>%
names()
under <- function(x) {
str_extract(x, pattern = "[0-9]*")
}
lvar <- nmhss2 %>%
dplyr::select(where(~ "1-10" %in% levels(.))) %>%
names()
lvar <- nmhss1 %>%
dplyr::select(where(~ "1-10" %in% levels(.))) %>%
names()
### for state
n1 <- nmhss1 %>%
#### yessing but needs to be done with 1 row per facility
group_by(name) %>%
mutate(across(all_of(yvar), .fns = list(count = ~sum(. == "yes"))),
TOT = n(),
across(all_of(lvar), .fns = list(lbound = ~sum(as.numeric(under(.x)), na.rm = TRUE)))) %>%
dplyr::select(-all_of(yvar))
View(n1)
### for state
n1 <- nmhss1 %>%
#### yessing but needs to be done with 1 row per facility
group_by(name) %>%
mutate(across(all_of(yvar), .fns = list(count = ~sum(. == "yes"))),
TOT = n(),
across(all_of(lvar), .fns = list(lbound = ~sum(as.numeric(under(.x)), na.rm = TRUE)))) %>%
dplyr::select(-all_of(yvar), -all_of(lvar))
View(n1)
#Please modify the chunk set up as you wish, some options are in # below
knitr::opts_chunk$set(fig.align = "center",
out.width = "90%",
out.height = "70%",
dpi = 600,
dev = 'png')
#Add packages
library(tidyverse)
library(cowplot)
library(ggridges)
library(kableExtra)
library(usmap)
library(corrplot)
library(readxl)
library(scales)
library(gridExtra)
library(ggrepel)
# how many faclities per state?
n1 %>%
dplyr::select(TOT, name) %>%
distinct() %>%
arrange(desc(TOT)) %>%
head(10)
# how many eper capita?
n1 %>%
left_join(pop, by = "name") %>%
dplyr::select(TOT, name, pop) %>%
dplyr::mutate(per_capita = TOT/pop) %>%
distinct() %>%
arrange(desc(per_capita)) %>%
head(10)
gc()
source("~/LocalRStudio/mhealth352/digest.R", echo=TRUE)
b1 <- brfss %>%
dplyr::select(-date, -PHYSHLTH, -MENTHLTH, -POORHLTH, -health, -HTM4, -WTKG3) %>%
dplyr::mutate(age = fct_collapse(age, "18-64" = c("18-24", "25-34", "35-44", "45-54", "55-64"),
"65+" = c("65+"))) %>%
na.omit()
View(b1)
gc()
source("~/LocalRStudio/mhealth352/digest.R", echo=TRUE)
b1 <- brfss %>%
dplyr::select(-date, -PHYSHLTH, -MENTHLTH, -POORHLTH, -health, -HTM4, -WTKG3) %>%
dplyr::mutate(age = fct_collapse(age, "18-64" = c("18-24", "25-34", "35-44", "45-54", "55-64"),
"65+" = c("65+"))) %>%
na.omit()
b2 <- b1 %>%
group_by(name) %>%
dplyr::mutate(X_BMI5 = mean(X_BMI5))
View(b2)
b2 <- b1 %>%
group_by(name) %>%
dplyr::mutate(X_BMI5 = mean(X_BMI5)) %>%
pivot_wider(id_cols = c("name", "X_BMI5"),
names_from = "qstlang",
values_from = "qstlang",
values_fn = list(count = count))
b2 <- b1 %>%
group_by(name) %>%
dplyr::mutate(X_BMI5 = mean(X_BMI5)) %>%
pivot_wider(id_cols = c("name", "X_BMI5"),
names_from = "qstlang",
values_fn = list(count = count))
b2 <- b1 %>%
group_by(name) %>%
dplyr::mutate(X_BMI5 = mean(X_BMI5)) %>%
pivot_wider(id_cols = c("name", "X_BMI5"),
names_from = "qstlang",
values_from = 0
values_fn = list(count = count))
b2 <- b1 %>%
group_by(name) %>%
dplyr::mutate(X_BMI5 = mean(X_BMI5)) %>%
pivot_wider(id_cols = c("name", "X_BMI5"),
names_from = "qstlang",
values_from = "sex",
values_fn = list(count = count))
b2 <- b1 %>%
group_by(name) %>%
dplyr::mutate(X_BMI5 = mean(X_BMI5)) %>%
pivot_wider(id_cols = c("name", "X_BMI5"),
names_from = "qstlang",
values_from = "sex",
values_fn = list(count = n()))
values_fn = list(count = length)
values_fn = list(count = length/n())
b2 <- b1 %>%
group_by(name) %>%
dplyr::mutate(X_BMI5 = mean(X_BMI5)) %>%
pivot_wider(id_cols = c("name", "X_BMI5"),
names_from = "qstlang",
values_from = "sex",
values_fn = list(count = length/n()))
b2 <- b1 %>%
group_by(name) %>%
dplyr::mutate(X_BMI5 = mean(X_BMI5)) %>%
pivot_wider(id_cols = c("name", "X_BMI5"),
names_from = "qstlang",
values_from = "sex",
values_fn = list(count = length/n()))
b2 <- b1 %>%
group_by(name) %>%
dplyr::mutate(X_BMI5 = mean(X_BMI5)) %>%
pivot_wider(id_cols = c("name", "X_BMI5"),
names_from = "qstlang",
values_from = "sex",
values_fn = list(count = length/nrow(b2)))
b2 <- b1 %>%
group_by(name) %>%
dplyr::mutate(X_BMI5 = mean(X_BMI5)) %>%
pivot_wider(id_cols = c("name", "X_BMI5"),
names_from = "qstlang",
values_from = "sex",
values_fn = list(count = length/nrow(b1)))
b2 <- b1 %>%
group_by(name) %>%
dplyr::mutate(X_BMI5 = mean(X_BMI5)) %>%
pivot_wider(id_cols = c("name", "X_BMI5"),
names_from = "qstlang",
values_from = "sex",
values_fn = list(count = length(.)/nrow(b1)))
b2 <- b1 %>%
group_by(name) %>%
dplyr::mutate(X_BMI5 = mean(X_BMI5)) %>%
pivot_wider(id_cols = c("name", "X_BMI5"),
names_from = "qstlang",
values_from = "sex",
values_fn = list(count = length))
b2 <- b1 %>%
group_by(name) %>%
dplyr::mutate(X_BMI5 = mean(X_BMI5)) %>%
pivot_wider(id_cols = c("name", "X_BMI5"),
names_from = "qstlang",
values_from = "sex",
values_fn = list(count = dplyr::count))
b2 <- b1 %>%
group_by(name) %>%
dplyr::mutate(X_BMI5 = mean(X_BMI5)) %>%
pivot_wider(id_cols = c("name", "X_BMI5"),
names_from = "qstlang",
values_from = "sex",
values_fn = list(count = count))
b2 <- b1 %>%
group_by(name) %>%
dplyr::mutate(X_BMI5 = mean(X_BMI5)) %>%
pivot_wider(id_cols = c("name", "X_BMI5"),
names_from = "qstlang",
values_from = "sex",
values_fn = list(count = tally))
b2 <- b1 %>%
group_by(name) %>%
dplyr::mutate(X_BMI5 = mean(X_BMI5)) %>%
pivot_wider(id_cols = c("name", "X_BMI5"),
names_from = "qstlang",
values_from = "qstlang",
values_fn = list(count = tally))
b2 <- b1 %>%
group_by(name) %>%
dplyr::mutate(X_BMI5 = mean(X_BMI5)) %>%
pivot_wider(id_cols = c("name", "X_BMI5"),
names_from = "qstlang",
values_from = "qstlang",
values_fn = list(count = count))
b2 <- b1 %>%
group_by(name) %>%
dplyr::mutate(X_BMI5 = mean(X_BMI5)) %>%
pivot_wider(id_cols = c("name", "X_BMI5"),
names_from = "qstlang",
values_from = "qstlang",
values_fn = list(count = n))
b2 <- b1 %>%
group_by(name) %>%
dplyr::mutate(X_BMI5 = mean(X_BMI5)) %>%
pivot_wider(id_cols = c("name", "X_BMI5"),
names_from = "qstlang",
names_transform = list(coun2 = n),
values_from = "qstlang",
values_fn = list(count = n))
b2 <- b1 %>%
group_by(name) %>%
dplyr::mutate(X_BMI5 = mean(X_BMI5)) %>%
pivot_wider(id_cols = c("name", "X_BMI5"),
names_from = "qstlang",
values_from = "qstlang",
values_fn = n)
b2 <- b1 %>%
group_by(name) %>%
dplyr::mutate(X_BMI5 = mean(X_BMI5)) %>%
pivot_wider(id_cols = c("name", "X_BMI5"),
names_from = "qstlang",
values_from = "qstlang",
values_fn = n(.))
values_fn = list(n = n(.))
values_fn = list(n = n)
b2 <- b1 %>%
group_by(name) %>%
dplyr::mutate(X_BMI5 = mean(X_BMI5)) %>%
pivot_wider(id_cols = c("name", "X_BMI5"),
names_from = "qstlang",
values_from = "qstlang",
values_fn = list(n = n))
b2 <- b1 %>%
group_by(name) %>%
dplyr::mutate(X_BMI5 = mean(X_BMI5)) %>%
pivot_wider(id_cols = c("name", "X_BMI5"),
names_from = "qstlang",
values_from = "qstlang",
values_fn = list(n = n))
require(here)
################################################################################
#### cdc first
# data dictionary
# https://www.cdc.gov/brfss/annual_data/2020/pdf/codebook20_llcp-v2-508.pdf
temp <- tempfile()
download.file("https://www.cdc.gov/brfss/annual_data/2020/files/LLCP2020XPT.zip",temp)
cdc <- read.xport(unz(temp, "LLCP202.XPT"))
require(foreign)
cdc <- read.xport(unz(temp, "LLCP202.XPT"))
cdc <- read.xport(unz(temp, "LLCP2020.XPT"))
temp
unz(temp, "LLCP2020.XPT")
f <- unz(temp, "LLCP2020.XPT")
f
class(f)
install.packages("rio")
library(rio)
cdc <- read_xpt(unz(temp, "LLCP2020.XPT"))
library(haven)
cdc <- read_xpt(unz(temp, "LLCP2020.XPT"))
cdc <- read_xpt(temp)
