subtitle = "Proportion of facilities, by state and facility ownership",
y = "Proportion of Facilities") +
annotate("segment", x = 1, y = 1.03, xend = 31, yend = 1.03,
arrow = arrow(type = "closed", length = unit(0.02, "npc"))) +
annotate("text", x = 23, y = 1.07, label = "More facilities per capita", size = 3.3, hjust = 0)
drilln(ownership) %>%
inner_join(pop, by = "state") %>%
ggplot() + geom_bar(aes(x = reorder(str_to_title(state), statecount/pop), y = count, fill = ownership),
stat = "identity", position = "fill") +
theme_classic() +
guides(fill = guide_legend(ncow = 3)) +
# coord_cartesian(xlim = c(1, 51), ylim = c(0, 1), clip = "off") +
theme(legend.position = "top",
axis.text.x = element_text(angle = 90, vjust = 0.2, hjust = 1),
axis.title.x = element_blank(),
legend.background = element_blank(),
legend.title = element_blank(),
legend.box.background = element_blank()) +
scale_y_continuous(breaks = c(0.25, 0.5, 0.75, 1.0)) +
fill_pal_discrete(factype) +
labs(title = "Most MH Facilities Are Owned by Private Non-Profit Organizations",
subtitle = "Proportion of facilities, by state and facility ownership",
y = "Proportion of Facilities") +
annotate("segment", x = 1, y = 1.03, xend = 31, yend = 1.03,
arrow = arrow(type = "closed", length = unit(0.02, "npc"))) +
annotate("text", x = 23, y = 1.07, label = "More facilities per capita", size = 3.3, hjust = 0)
p <- drilln(facilitytype) %>%
inner_join(pop, by = "state") %>%
ggplot() + geom_bar(aes(x = reorder(str_to_title(state), pop),
y = count/pop * 100000, fill = facilitytype,
text = paste0(round(count/pop * 100000, 2), "\n", facilitytype)),
stat = "identity", position = "stack") +
fill_pal_discrete(factype) +
theme_classic() +
guides(fill = guide_legend(nrow  = 6)) +
theme(legend.position = "bottom",
axis.text.x = element_text(angle = 90, vjust = 0.2, hjust = 1),
axis.title.x = element_blank(),
legend.title = element_blank()) +
labs(title = "Outpatient and Community Centers Account for MOst of the Diffferences",
subtitle = "Number of facilities, by state and type, proportional to population",
y = "Facilities per 100,000 residents") +
annotate("segment", x = 1, y = 15, xend = 31, yend = 15,
arrow = arrow(type = "closed", length = unit(0.02, "npc"))) +
annotate("text", x = 24, y = 14, label = "More residents", size = 3.3, hjust = 0)
p
ggplotly(p, tooltip = "text")
p <- drilln(facilitytype) %>%
inner_join(pop, by = "state") %>%
ggplot() + geom_bar(aes(x = reorder(str_to_title(state), pop),
y = count/pop * 100000, fill = facilitytype,
text = paste0(round(count/pop * 100000, 2), "\n", facilitytype)),
stat = "identity", position = "stack") +
fill_pal_discrete(factype) +
theme_classic() +
guides(fill = guide_legend(nrow  = 6)) +
theme(legend.position = "bottom",
axis.text.x = element_text(angle = 90, vjust = 0.2, hjust = 1),
axis.title.x = element_blank(),
legend.title = element_blank()) +
labs(title = "Outpatient and Community Centers Account for Most of State Diffferences",
subtitle = "Number of facilities, by state and type, proportional to population",
y = "Facilities per 100,000 residents") +
annotate("segment", x = 1, y = 15, xend = 31, yend = 15,
arrow = arrow(type = "closed", length = unit(0.02, "npc"))) +
annotate("text", x = 24, y = 14, label = "More residents", size = 3.3, hjust = 0)
p
p <- drilln(facilitytype) %>%
inner_join(pop, by = "state") %>%
ggplot() + geom_bar(aes(x = reorder(str_to_title(state), pop),
y = count/pop * 100000, fill = facilitytype,
text = paste0(round(count/pop * 100000, 2), "\n", facilitytype)),
stat = "identity", position = "stack") +
fill_pal_discrete(factype) +
theme_classic() +
guides(fill = guide_legend(nrow  = 6)) +
theme(legend.position = "bottom",
axis.text.x = element_text(angle = 90, vjust = 0.2, hjust = 1),
axis.title.x = element_blank(),
legend.title = element_blank()) +
labs(title = "Outpatient and Community Centers Account for State Diffferences",
subtitle = "Number of facilities, by state and type, proportional to population",
y = "Facilities per 100,000 residents") +
annotate("segment", x = 1, y = 15, xend = 31, yend = 15,
arrow = arrow(type = "closed", length = unit(0.02, "npc"))) +
annotate("text", x = 24, y = 14, label = "More residents", size = 3.3, hjust = 0)
p
drilln(ownership) %>%
inner_join(pop, by = "state") %>%
ggplot() + geom_bar(aes(x = reorder(str_to_title(state), statecount/pop), y = count, fill = ownership),
stat = "identity", position = "fill") +
theme_classic() +
guides(fill = guide_legend(ncow = 3)) +
# coord_cartesian(xlim = c(1, 51), ylim = c(0, 1), clip = "off") +
theme(legend.position = "top",
axis.text.x = element_text(angle = 90, vjust = 0.2, hjust = 1),
axis.title.x = element_blank(),
legend.background = element_blank(),
legend.title = element_blank(),
legend.box.background = element_blank()) +
scale_y_continuous(breaks = c(0.25, 0.5, 0.75, 1.0)) +
fill_pal_discrete(factype) +
labs(title = "Most MH Facilities Are Owned by Private Non-Profit Organizations",
subtitle = "Proportion of facilities, by state and facility ownership",
y = "Proportion of Facilities") +
annotate("segment", x = 1, y = 1.03, xend = 31, yend = 1.03,
arrow = arrow(type = "closed", length = unit(0.02, "npc"))) +
annotate("text", x = 23, y = 1.07, label = "More facilities per capita", size = 3.3, hjust = 0)
p <- drilln(facilitytype) %>%
inner_join(pop, by = "state") %>%
ggplot() + geom_bar(aes(x = reorder(str_to_title(state), pop),
y = count/pop * 100000, fill = facilitytype,
text = paste0(round(count/pop * 100000, 2), "\n", facilitytype)),
stat = "identity", position = "stack") +
fill_pal_discrete(factype) +
theme_classic() +
guides(fill = guide_legend(nrow  = 6)) +
theme(legend.position = "top",
axis.text.x = element_text(angle = 90, vjust = 0.2, hjust = 1),
axis.title.x = element_blank(),
legend.title = element_blank()) +
labs(title = "Outpatient and Community Centers Account for State Diffferences",
subtitle = "Number of facilities, by state and type, proportional to population",
y = "Facilities per 100,000 residents") +
annotate("segment", x = 1, y = 15, xend = 31, yend = 15,
arrow = arrow(type = "closed", length = unit(0.02, "npc"))) +
annotate("text", x = 24, y = 14, label = "More residents", size = 3.3, hjust = 0)
p
drilln(ownership) %>%
inner_join(pop, by = "state") %>%
ggplot() + geom_bar(aes(x = reorder(str_to_title(state), statecount/pop), y = count, fill = ownership),
stat = "identity", position = "fill") +
theme_classic() +
guides(fill = guide_legend(ncow = 3)) +
# coord_cartesian(xlim = c(1, 51), ylim = c(0, 1), clip = "off") +
theme(legend.position = "top",
axis.text.x = element_text(angle = 90, vjust = 0.2, hjust = 1),
axis.title.x = element_blank(),
legend.background = element_blank(),
legend.title = element_blank(),
legend.box.background = element_blank()) +
scale_y_continuous(breaks = c(0.25, 0.5, 0.75, 1.0)) +
fill_pal_discrete(factype) +
labs(title = "Most MH Facilities Are Owned by Private Non-Profit Organizations",
subtitle = "Proportion of facilities, by state and facility ownership",
y = "Proportion of Facilities") +
annotate("segment", x = 1, y = 1.03, xend = 31, yend = 1.03,
arrow = arrow(type = "closed", length = unit(0.02, "npc"))) +
annotate("text", x = 23, y = 1.07, label = "More facilities per capita", size = 3.3, hjust = 0)
p <- drilln(facilitytype) %>%
inner_join(pop, by = "state") %>%
ggplot() + geom_bar(aes(x = reorder(str_to_title(state), pop),
y = count/pop * 100000, fill = facilitytype,
text = paste0(round(count/pop * 100000, 2), "\n", facilitytype)),
stat = "identity", position = "stack") +
fill_pal_discrete(factype) +
theme_classic() +
guides(fill = guide_legend(nrow  = 6)) +
theme(legend.position = "top",
axis.text.x = element_text(angle = 90, vjust = 0.2, hjust = 1),
axis.title.x = element_blank(),
legend.title = element_blank()) +
labs(title = "Outpatient and Community Centers Account for State Diffferences",
subtitle = "Number of facilities, by state and type, proportional to population",
y = "Facilities per 100,000 residents") +
annotate("segment", x = 1, y = 15, xend = 31, yend = 15,
arrow = arrow(type = "closed", length = unit(0.02, "npc"))) +
annotate("text", x = 24, y = 14, label = "More residents", size = 3.3, hjust = 0)
p
drilln(ownership) %>%
inner_join(pop, by = "state") %>%
ggplot() + geom_bar(aes(x = reorder(str_to_title(state), statecount/pop), y = count, fill = ownership),
stat = "identity", position = "fill") +
theme_classic() +
guides(fill = guide_legend(ncow = 3)) +
# coord_cartesian(xlim = c(1, 51), ylim = c(0, 1), clip = "off") +
theme(legend.position = "top",
axis.text.x = element_text(angle = 90, vjust = 0.2, hjust = 1),
axis.title.x = element_blank(),
legend.background = element_blank(),
legend.title = element_blank(),
legend.box.background = element_blank()) +
scale_y_continuous(breaks = c(0.25, 0.5, 0.75, 1.0)) +
fill_pal_discrete(factype) +
labs(title = "Most MH Facilities Are Owned by Private Non-Profit Organizations",
subtitle = "Proportion of facilities, by state and facility ownership",
y = "Proportion of Facilities") +
annotate("segment", x = 1, y = 1.03, xend = 31, yend = 1.03,
arrow = arrow(type = "closed", length = unit(0.02, "npc"))) +
annotate("text", x = 23, y = 1.07, label = "More facilities per capita", size = 3.3, hjust = 0)
drilln(operator) %>%
filter(operator != "logical skip") %>%
right_join(pop, by = "state") %>%
ggplot() + geom_bar(aes(x = reorder(str_to_title(state), statecount/pop), y = count, fill = operator),
stat = "identity", position = "fill") +
coord_cartesian(xlim = c(1, 51), ylim = c(0, 1), clip = "off") +
theme_classic() +
guides(fill = guide_legend(nrow  = 3, ncol = 3)) +
theme(axis.text.x = element_text(angle = 90, vjust = 0.2, hjust = 1),
axis.title.x = element_blank(),
legend.position =  "top",
legend.title = element_blank(),
legend.background = element_blank(),
legend.box.background = element_blank()) +
fill_pal_discrete(factype) +
labs(title = "State & Regional Involvement Varies",
subtitle = "Proportion of publicly owned facilities, by state and operating body",
y = "Proportion of Facilities") +
annotate("segment", x = 1, y = 1.03, xend = 31, yend = 1.03,
arrow = arrow(type = "closed", length = unit(0.02, "npc"))) +
annotate("text", x = 23, y = 1.07, label = "More facilities per capita", size = 3.3, hjust = 0)
drilln(operator) %>%
filter(operator != "logical skip") %>%
right_join(pop, by = "state") %>%
ggplot() + geom_bar(aes(x = reorder(str_to_title(state), statecount/pop), y = count, fill = operator),
stat = "identity", position = "fill") +
coord_cartesian(xlim = c(1, 51), ylim = c(0, 1), clip = "off") +
theme_classic() +
guides(fill = guide_legend(nrow  = 3, ncol = 3)) +
theme(axis.text.x = element_text(angle = 90, vjust = 0.2, hjust = 1),
axis.title.x = element_blank(),
legend.position =  "top",
legend.title = element_blank(),
legend.background = element_blank(),
legend.box.background = element_blank()) +
fill_pal_discrete(factype) +
labs(title = "State & Regional Involvement Varies",
subtitle = "Proportion of publicly owned facilities, by state and operating body",
y = "Proportion of Facilities") +
annotate("segment", x = 1, y = 1.03, xend = 31, yend = 1.03,
arrow = arrow(type = "closed", length = unit(0.02, "npc"))) +
annotate("text", x = 23, y = 1.07, label = "More facilities per capita", size = 3.3, hjust = 0)
drilln(operator) %>%
filter(operator != "logical skip") %>%
inner_join(pop, by = "state") %>%
ggplot() + geom_bar(aes(x = reorder(str_to_title(state), statecount/pop), y = count, fill = operator),
stat = "identity", position = "fill") +
coord_cartesian(xlim = c(1, 51), ylim = c(0, 1), clip = "off") +
theme_classic() +
guides(fill = guide_legend(nrow  = 3, ncol = 3)) +
theme(axis.text.x = element_text(angle = 90, vjust = 0.2, hjust = 1),
axis.title.x = element_blank(),
legend.position =  "top",
legend.title = element_blank(),
legend.background = element_blank(),
legend.box.background = element_blank()) +
fill_pal_discrete(factype) +
labs(title = "State & Regional Involvement Varies",
subtitle = "Proportion of publicly owned facilities, by state and operating body",
y = "Proportion of Facilities") +
annotate("segment", x = 1, y = 1.03, xend = 31, yend = 1.03,
arrow = arrow(type = "closed", length = unit(0.02, "npc"))) +
annotate("text", x = 23, y = 1.07, label = "More facilities per capita", size = 3.3, hjust = 0)
drilln(operator) %>%
filter(operator != "logical skip") %>%
inner_join(pop, by = "state") %>%
ggplot() + geom_bar(aes(x = reorder(str_to_title(state), statecount), y = count, fill = operator),
stat = "identity", position = "fill") +
coord_cartesian(xlim = c(1, 51), ylim = c(0, 1), clip = "off") +
theme_classic() +
guides(fill = guide_legend(nrow  = 3, ncol = 3)) +
theme(axis.text.x = element_text(angle = 90, vjust = 0.2, hjust = 1),
axis.title.x = element_blank(),
legend.position =  "top",
legend.title = element_blank(),
legend.background = element_blank(),
legend.box.background = element_blank()) +
fill_pal_discrete(factype) +
labs(title = "State & Regional Involvement Varies",
subtitle = "Proportion of publicly owned facilities, by state and operating body",
y = "Proportion of Facilities") +
annotate("segment", x = 1, y = 1.03, xend = 31, yend = 1.03,
arrow = arrow(type = "closed", length = unit(0.02, "npc"))) +
annotate("text", x = 23, y = 1.07, label = "More facilities per capita", size = 3.3, hjust = 0)
drilln(operator) %>%
filter(operator != "logical skip") %>%
inner_join(pop, by = "state")
drilln(operator) %>%
filter(operator != "logical skip") %>%
inner_join(pop, by = "state") %>%
ggplot() + geom_bar(aes(x = reorder(str_to_title(state), statecount/pop), y = count, fill = operator),
stat = "identity", position = "fill") +
coord_cartesian(xlim = c(1, 51), ylim = c(0, 1), clip = "off") +
theme_classic() +
guides(fill = guide_legend(nrow  = 3, ncol = 3)) +
theme(axis.text.x = element_text(angle = 90, vjust = 0.2, hjust = 1),
axis.title.x = element_blank(),
legend.position =  "top",
legend.title = element_blank(),
legend.background = element_blank(),
legend.box.background = element_blank()) +
fill_pal_discrete(factype) +
labs(title = "State & Regional Involvement Varies",
subtitle = "Proportion of publicly owned facilities, by state and operating body",
y = "Proportion of Facilities") +
annotate("segment", x = 1, y = 1.03, xend = 31, yend = 1.03,
arrow = arrow(type = "closed", length = unit(0.02, "npc"))) +
annotate("text", x = 23, y = 1.07, label = "More facilities per capita", size = 3.3, hjust = 0)
drilln(operator) %>%
filter(operator != "logical skip") %>%
inner_join(pop, by = "state") %>%
ggplot() + geom_bar(aes(x = reorder(str_to_title(state), statecount/pop), y = count, fill = operator),
stat = "identity", position = "fill") +
coord_cartesian(xlim = c(1, 51), ylim = c(0, 1), clip = "off") +
theme_classic() +
guides(fill = guide_legend(nrow  = 3, ncol = 3)) +
theme(axis.text.x = element_text(angle = 90, vjust = 0.2, hjust = 1),
axis.title.x = element_blank(),
legend.position =  "top",
legend.title = element_blank(),
legend.background = element_blank(),
legend.box.background = element_blank()) +
fill_pal_discrete(factype) +
labs(title = "State & Regional Involvement Varies",
subtitle = "Proportion of publicly owned facilities, by state and operating body",
y = "Proportion of Facilities") +
annotate("segment", x = 1, y = 1.03, xend = 31, yend = 1.03,
arrow = arrow(type = "closed", length = unit(0.02, "npc"))) +
annotate("text", x = 23, y = 1.07, label = "More facilities per capita", size = 3.3, hjust = 0)
drilln(focus) %>%
filter(focus != "logical skip") %>%
inner_join(pop, by = "state") %>%
ggplot() + geom_bar(aes(x = reorder(str_to_title(state), statecount/pop), y = count, fill = operator),
stat = "identity", position = "fill") +
coord_cartesian(xlim = c(1, 51), ylim = c(0, 1), clip = "off") +
theme_classic() +
guides(fill = guide_legend(nrow  = 3, ncol = 3)) +
theme(axis.text.x = element_text(angle = 90, vjust = 0.2, hjust = 1),
axis.title.x = element_blank(),
legend.position =  "top",
legend.title = element_blank(),
legend.background = element_blank(),
legend.box.background = element_blank()) +
fill_pal_discrete(factype) +
labs(title = "State & Regional Involvement Varies",
subtitle = "Proportion of publicly owned facilities, by state and operating body",
y = "Proportion of Facilities") +
annotate("segment", x = 1, y = 1.03, xend = 31, yend = 1.03,
arrow = arrow(type = "closed", length = unit(0.02, "npc"))) +
annotate("text", x = 23, y = 1.07, label = "More facilities per capita", size = 3.3, hjust = 0)
drilln(focus) %>%
filter(focus != "logical skip") %>%
inner_join(pop, by = "state") %>%
ggplot() + geom_bar(aes(x = reorder(str_to_title(state), statecount/pop), y = count, fill = focus),
stat = "identity", position = "fill") +
coord_cartesian(xlim = c(1, 51), ylim = c(0, 1), clip = "off") +
theme_classic() +
guides(fill = guide_legend(nrow  = 3, ncol = 3)) +
theme(axis.text.x = element_text(angle = 90, vjust = 0.2, hjust = 1),
axis.title.x = element_blank(),
legend.position =  "top",
legend.title = element_blank(),
legend.background = element_blank(),
legend.box.background = element_blank()) +
fill_pal_discrete(factype) +
labs(title = "State & Regional Involvement Varies",
subtitle = "Proportion of publicly owned facilities, by state and operating body",
y = "Proportion of Facilities") +
annotate("segment", x = 1, y = 1.03, xend = 31, yend = 1.03,
arrow = arrow(type = "closed", length = unit(0.02, "npc"))) +
annotate("text", x = 23, y = 1.07, label = "More facilities per capita", size = 3.3, hjust = 0)
drilln(focus) %>%
filter(focus != "logical skip") %>%
inner_join(pop, by = "state") %>%
ggplot() + geom_bar(aes(x = reorder(str_to_title(state), statecount), y = count, fill = focus),
stat = "identity", position = "fill") +
coord_cartesian(xlim = c(1, 51), ylim = c(0, 1), clip = "off") +
theme_classic() +
guides(fill = guide_legend(nrow  = 3, ncol = 3)) +
theme(axis.text.x = element_text(angle = 90, vjust = 0.2, hjust = 1),
axis.title.x = element_blank(),
legend.position =  "top",
legend.title = element_blank(),
legend.background = element_blank(),
legend.box.background = element_blank()) +
fill_pal_discrete(factype) +
labs(title = "State & Regional Involvement Varies",
subtitle = "Proportion of publicly owned facilities, by state and operating body",
y = "Proportion of Facilities") +
annotate("segment", x = 1, y = 1.03, xend = 31, yend = 1.03,
arrow = arrow(type = "closed", length = unit(0.02, "npc"))) +
annotate("text", x = 23, y = 1.07, label = "More facilities per capita", size = 3.3, hjust = 0)
drilln(focus) %>%
filter(focus != "logical skip") %>%
inner_join(pop, by = "state") %>%
ggplot() + geom_bar(aes(x = reorder(str_to_title(state), statecount/pop), y = count, fill = focus),
stat = "identity", position = "fill") +
coord_cartesian(xlim = c(1, 51), ylim = c(0, 1), clip = "off") +
theme_classic() +
guides(fill = guide_legend(nrow  = 2, ncol = 2)) +
theme(axis.text.x = element_text(angle = 90, vjust = 0.2, hjust = 1),
axis.title.x = element_blank(),
legend.position =  "top",
legend.title = element_blank(),
legend.background = element_blank(),
legend.box.background = element_blank()) +
fill_pal_discrete(factype) +
labs(title = "Facility Focus",
subtitle = "Proportion of publicly owned facilities, by state and operating body",
y = "Proportion of Facilities") +
annotate("segment", x = 1, y = 1.03, xend = 31, yend = 1.03,
arrow = arrow(type = "closed", length = unit(0.02, "npc"))) +
annotate("text", x = 23, y = 1.07, label = "More facilities per capita", size = 3.3, hjust = 0)
drilln(operator) %>%
filter(operator != "logical skip") %>%
inner_join(pop, by = "state") %>%
ggplot() + geom_bar(aes(x = reorder(str_to_title(state), statecount/pop), y = count, fill = operator),
stat = "identity", position = "fill") +
coord_cartesian(xlim = c(1, 51), ylim = c(0, 1), clip = "off") +
theme_classic() +
guides(fill = guide_legend(nrow  = 3, ncol = 3)) +
theme(axis.text.x = element_text(angle = 90, vjust = 0.2, hjust = 1),
axis.title.x = element_blank(),
legend.position =  "top",
legend.title = element_blank(),
legend.background = element_blank(),
legend.box.background = element_blank()) +
fill_pal_discrete(factype) +
labs(title = "State & Regional Involvement Varies",
subtitle = "Proportion of publicly owned facilities, by state and operating body",
y = "Proportion of Facilities") +
annotate("segment", x = 1, y = 1.03, xend = 31, yend = 1.03,
arrow = arrow(type = "closed", length = unit(0.02, "npc"))) +
annotate("text", x = 23, y = 1.07, label = "More facilities per capita", size = 3.3, hjust = 0)
# By focus
drilln(focus) %>%
filter(focus != "logical skip") %>%
inner_join(pop, by = "state") %>%
ggplot() + geom_bar(aes(x = reorder(str_to_title(state), statecount/pop), y = count, fill = focus),
stat = "identity", position = "fill") +
coord_cartesian(xlim = c(1, 51), ylim = c(0, 1), clip = "off") +
theme_classic() +
guides(fill = guide_legend(nrow  = 2, ncol = 2)) +
theme(axis.text.x = element_text(angle = 90, vjust = 0.2, hjust = 1),
axis.title.x = element_blank(),
legend.position =  "top",
legend.title = element_blank(),
legend.background = element_blank(),
legend.box.background = element_blank()) +
fill_pal_discrete(factype) +
labs(title = "Few Facilities ",
subtitle = "Proportion of publicly owned facilities, by state and operating body",
y = "Proportion of Facilities") +
annotate("segment", x = 1, y = 1.03, xend = 31, yend = 1.03,
arrow = arrow(type = "closed", length = unit(0.02, "npc"))) +
annotate("text", x = 23, y = 1.07, label = "More facilities per capita", size = 3.3, hjust = 0)
# By focus
drilln(focus) %>%
filter(focus != "logical skip") %>%
inner_join(pop, by = "state") %>%
ggplot() + geom_bar(aes(x = reorder(str_to_title(state), statecount/pop), y = count, fill = focus),
stat = "identity", position = "fill") +
coord_cartesian(xlim = c(1, 51), ylim = c(0, 1), clip = "off") +
theme_classic() +
guides(fill = guide_legend(nrow  = 2, ncol = 2)) +
theme(axis.text.x = element_text(angle = 90, vjust = 0.2, hjust = 1),
axis.title.x = element_blank(),
legend.position =  "top",
legend.title = element_blank(),
legend.background = element_blank(),
legend.box.background = element_blank()) +
fill_pal_discrete(factype) +
labs(title = "Most Facilies Primary Focus is Mental Health",
subtitle = "Facilities by state and treatment focus",
y = "Proportion of Facilities") +
annotate("segment", x = 1, y = 1.03, xend = 31, yend = 1.03,
arrow = arrow(type = "closed", length = unit(0.02, "npc"))) +
annotate("text", x = 23, y = 1.07, label = "More facilities per capita", size = 3.3, hjust = 0)
# By focus
drilln(focus) %>%
filter(focus != "logical skip") %>%
inner_join(pop, by = "state") %>%
ggplot() + geom_bar(aes(x = reorder(str_to_title(state), statecount/pop), y = count, fill = focus),
stat = "identity", position = "fill") +
coord_cartesian(xlim = c(1, 51), ylim = c(0, 1), clip = "off") +
theme_classic() +
guides(fill = guide_legend(nrow  = 2, ncol = 2)) +
theme(axis.text.x = element_text(angle = 90, vjust = 0.2, hjust = 1),
axis.title.x = element_blank(),
legend.position =  "top",
legend.title = element_blank(),
legend.background = element_blank(),
legend.box.background = element_blank()) +
fill_pal_discrete(factype) +
labs(title = "Most Facilities Primary Focus is Mental Health",
subtitle = "Facilities by state and treatment focus",
y = "Proportion of Facilities") +
annotate("segment", x = 1, y = 1.03, xend = 31, yend = 1.03,
arrow = arrow(type = "closed", length = unit(0.02, "npc"))) +
annotate("text", x = 23, y = 1.07, label = "More facilities per capita", size = 3.3, hjust = 0)
# By focus
drilln(focus) %>%
filter(focus != "logical skip") %>%
inner_join(pop, by = "state") %>%
ggplot() + geom_bar(aes(x = reorder(str_to_title(state), statecount/pop), y = count, fill = focus),
stat = "identity", position = "fill") +
coord_cartesian(xlim = c(1, 51), ylim = c(0, 1), clip = "off") +
theme_classic() +
guides(fill = guide_legend(nrow  = 2, ncol = 2)) +
theme(axis.text.x = element_text(angle = 90, vjust = 0.2, hjust = 1),
axis.title.x = element_blank(),
legend.position =  "top",
legend.title = element_blank(),
legend.background = element_blank(),
legend.box.background = element_blank()) +
fill_pal_discrete(factype) +
labs(title = "Most Facilities Primary Focus is Mental Health",
subtitle = "Facilities by state and treatment focus",
y = "Proportion of Facilities") +
annotate("segment", x = 1, y = 1.03, xend = 31, yend = 1.03,
arrow = arrow(type = "closed", length = unit(0.02, "npc"))) +
annotate("text", x = 23, y = 1.07, label = "More facilities per capita", size = 3.3, hjust = 0)
