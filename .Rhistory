continuous = grDevices::colorRampPalette(palette)(n),
discrete = palette[1:n]
)
structure(out, name = "pal" class, = "palette")
}
cvi_palettes(pal, 3)
cvi_palettes(pal, 3)[1]
cvi_palettes(pal, 3)[2]
cvi_palettes(pal, 3)$name
cvi_palettes(pal, 3)$`, name`
scale_fill_cvi_c = function(name) {
ggplot2::scale_fill_gradientn(colours = cvi_palettes(name = name,
type = "continuous"))
}
scale_fill_cvi_c = function(name) {
ggplot2::scale_fill_gradientn(colours = cvi_palettes(palette = pal,
type = "continuous"))
}
scale_fill_pal = function(name) {
ggplot2::scale_fill_gradientn(colours = cvi_palettes(palette = pal,
type = "continuous"))
}
scale_fill_pal = function(name) {
ggplot2::scale_fill_gradientn(colours = cvi_palettes(palette = pal,
type = "discrete"))
}
## by facility type
drilln(facilitytype) %>%
ggplot() + geom_bar(aes(x = reorder(state, count), y = count, fill = facilitytype),
stat = "identity", position = "stack") +
scale_fill_manual() +
theme_classic() +
guides(fill = guide_legend(nrow  = 6)) +
theme(legend.position = "bottom", axis.text.x = element_text(angle = 45),
axis.title.x = element_blank()) +
scale_fill_pal()
scale_fill_pal = function(name) {
ggplot2::scale_fill_gradientn(colours = cvi_palettes(palette = pal,
type = "continuous"))
}
## by facility type
drilln(facilitytype) %>%
ggplot() + geom_bar(aes(x = reorder(state, count), y = count, fill = facilitytype),
stat = "identity", position = "stack") +
scale_fill_manual() +
theme_classic() +
guides(fill = guide_legend(nrow  = 6)) +
theme(legend.position = "bottom", axis.text.x = element_text(angle = 45),
axis.title.x = element_blank()) +
scale_fill_pal()
## by facility type
drilln(facilitytype) %>%
ggplot() + geom_bar(aes(x = reorder(state, count), y = count, fill = facilitytype),
stat = "identity", position = "stack") +
theme_classic() +
guides(fill = guide_legend(nrow  = 6)) +
theme(legend.position = "bottom", axis.text.x = element_text(angle = 45),
axis.title.x = element_blank()) +
scale_fill_pal()
scale_fill_pal = function(palette = pal) {
ggplot2::scale_fill_manual(values = cvi_palettes(palette,
type = "discrete"))
}
## by facility type
drilln(facilitytype) %>%
ggplot() + geom_bar(aes(x = reorder(state, count), y = count, fill = facilitytype),
stat = "identity", position = "stack") +
theme_classic() +
guides(fill = guide_legend(nrow  = 6)) +
theme(legend.position = "bottom", axis.text.x = element_text(angle = 45),
axis.title.x = element_blank()) +
scale_fill_pal()
pal <- c("#001219", "#005f73", "#0a9396", "#94d2bd", "#e9d8a6", "#ee9b00", "#ca6702", "#bb3e03", "#CA8D8F", "#ae2012", "#9b2226", "#61252F")
cvi_palettes = function(palette, n, type = c("discrete", "continuous")) {
if (missing(n)) {
n = length(palette)
}
type = match.arg(type)
out = switch(type,
continuous = grDevices::colorRampPalette(palette)(n),
discrete = palette[1:n]
)
structure(out, name = "pal" ,class = "palette")
}
cvi_palettes(pal, 3)
scale_fill_pal = function(palette = pal) {
ggplot2::scale_fill_manual(values = cvi_palettes(palette,
type = "discrete"))
}
## by facility type
drilln(facilitytype) %>%
ggplot() + geom_bar(aes(x = reorder(state, count), y = count, fill = facilitytype),
stat = "identity", position = "stack") +
theme_classic() +
guides(fill = guide_legend(nrow  = 6)) +
theme(legend.position = "bottom", axis.text.x = element_text(angle = 45),
axis.title.x = element_blank()) +
scale_fill_pal()
scale_fill_pal = function(palette) {
ggplot2::scale_fill_manual(values = cvi_palettes(palette,
type = "discrete"))
}
pal2 <- c("#264653", "#287271", "#2a9d8f", "#8ab17d", "#babb74", "#e9c46a", "#efb366", "#f4a261", "#ee8959", "#e76f51", "#DA5231", "#B85146")
cvi_palettes = function(palette, n, type = c("discrete", "continuous")) {
if (missing(n)) {
n = length(palette)
}
type = match.arg(type)
out = switch(type,
continuous = grDevices::colorRampPalette(palette)(n),
discrete = palette[1:n]
)
structure(out, name = "pal" ,class = "palette")
}
cvi_palettes(pal, 3)
scale_fill_pal = function(palette) {
ggplot2::scale_fill_manual(values = cvi_palettes(palette,
type = "discrete"))
}
## by facility type
drilln(facilitytype) %>%
ggplot() + geom_bar(aes(x = reorder(state, count), y = count, fill = facilitytype),
stat = "identity", position = "stack") +
theme_classic() +
guides(fill = guide_legend(nrow  = 6)) +
theme(legend.position = "bottom", axis.text.x = element_text(angle = 45),
axis.title.x = element_blank()) +
scale_fill_pal(pal2)
ggsave("./figs/plot14.png")
ggplot(data, aes(x = long, y = lat,
group = group, fill = per * 100)) +
coord_map(projection = "albers", lat0 = 39, lat1 = 45) +
geom_polygon(color = "#8d99ae", size = 0.1) +
theme_map() + labs(fill = "Percent", title = "Percentage of Respondents Who Had \n14+ Bad Mental Health Days",
caption = "BRFSS") +
scale_fill_pal(palette = pal2) +
theme(text = element_text(size = 10))
ggplot(data, aes(x = long, y = lat,
group = group, fill = per * 100)) +
coord_map(projection = "albers", lat0 = 39, lat1 = 45) +
geom_polygon(color = "#8d99ae", size = 0.1) +
theme_map() + labs(fill = "Percent", title = "Percentage of Respondents Who Had \n14+ Bad Mental Health Days",
caption = "BRFSS") +
scale_fill_pal(palette = pal2) +
theme(text = element_text(size = 10))
#### % who had > 13 bad MHD
data <- brfss %>%
group_by(state) %>%
summarise(per = sum(ifelse(ment14d == "14+", 1, 0), na.rm = TRUE)/n()) %>%
distinct() %>%
right_join(us_states, by = c("state" = "region"))
ggplot(data, aes(x = long, y = lat,
group = group, fill = per * 100)) +
coord_map(projection = "albers", lat0 = 39, lat1 = 45) +
geom_polygon(color = "#8d99ae", size = 0.1) +
theme_map() + labs(fill = "Percent", title = "Percentage of Respondents Who Had \n14+ Bad Mental Health Days",
caption = "BRFSS") +
scale_fill_pal(palette = pal2) +
theme(text = element_text(size = 10))
ggplot(data, aes(x = long, y = lat,
group = group, fill = per * 100)) +
coord_map(projection = "albers", lat0 = 39, lat1 = 45) +
geom_polygon(color = "#8d99ae", size = 0.1) +
theme_map() + labs(fill = "Percent", title = "Percentage of Respondents Who Had \n14+ Bad Mental Health Days",
caption = "BRFSS") +
scale_fill_pal(pal2) +
theme(text = element_text(size = 10))
ggplot(data, aes(x = long, y = lat,
group = group, fill = per * 100)) +
coord_map(projection = "albers", lat0 = 39, lat1 = 45) +
geom_polygon(color = "#8d99ae", size = 0.1) +
theme_map() + labs(fill = "Percent", title = "Percentage of Respondents Who Had \n14+ Bad Mental Health Days",
caption = "BRFSS") +
scale_fill_distiller(palette = pal2) +
theme(text = element_text(size = 10))
ggplot(data, aes(x = long, y = lat,
group = group, fill = per * 100)) +
coord_map(projection = "albers", lat0 = 39, lat1 = 45) +
geom_polygon(color = "#8d99ae", size = 0.1) +
theme_map() + labs(fill = "Percent", title = "Percentage of Respondents Who Had \n14+ Bad Mental Health Days",
caption = "BRFSS") +
scale_fill_distiller(palette = "Spectral") +
theme(text = element_text(size = 10))
#### % woh had >0 bad MHD
data <- brfss %>%
group_by(state) %>%
summarise(per = sum(ifelse(ment14d != "0", 1, 0), na.rm = TRUE)/n()) %>%
distinct() %>%
right_join(us_states, by = c("state" = "region"))
ggplot(data, aes(x = long, y = lat,
group = group, fill = per * 100)) +
coord_map(projection = "albers", lat0 = 39, lat1 = 45) +
geom_polygon(color = "#8d99ae", size = 0.1) +
theme_map() + labs(fill = "Percent", title = "Percentage of Respondents Who Had \nat Least 1 Bad Mental Health Day",
caption = "BRFSS") +
scale_fill_distiller(palette = "Spectral") +
theme(text = element_text(size = 10))
ggsave("./figs/plot8.png")
data <- nmhss %>%
group_by(state) %>%
summarise(state, n = n()) %>%
distinct() %>%
right_join(us_states, by = c("state" = "region"))
ggplot(data, aes(x = long, y = lat,
group = group, fill = n)) +
coord_map(projection = "albers", lat0 = 39, lat1 = 45) +
geom_polygon(color = "#8d99ae", size = 0.1) +
theme_map() + labs(fill = "Count", title = "Total Number of Mental Health Facilities",
caption = "N-MHSS") +
scale_fill_distiller(palette = "Spectral") +
theme(text = element_text(size = 10))
data <- nmhss %>%
group_by(state) %>%
summarise(state, n = n()) %>%
distinct() %>%
right_join(us_states, by = c("state" = "region"))
ggplot(data, aes(x = long, y = lat,
group = group, fill = n)) +
coord_map(projection = "albers", lat0 = 39, lat1 = 45) +
geom_polygon(color = "#8d99ae", size = 0.1) +
theme_map() + labs(fill = "Count", title = "Total Number of Mental Health Facilities",
caption = "N-MHSS") +
scale_fill_distiller(palette = cvi_palettes()) +
theme(text = element_text(size = 10))
ggplot(data, aes(x = long, y = lat,
group = group, fill = n)) +
coord_map(projection = "albers", lat0 = 39, lat1 = 45) +
geom_polygon(color = "#8d99ae", size = 0.1) +
theme_map() + labs(fill = "Count", title = "Total Number of Mental Health Facilities",
caption = "N-MHSS") +
scale_fill_distiller(palette = cvi_palettes(pal2)) +
theme(text = element_text(size = 10))
ggplot(data, aes(x = long, y = lat,
group = group, fill = n)) +
coord_map(projection = "albers", lat0 = 39, lat1 = 45) +
geom_polygon(color = "#8d99ae", size = 0.1) +
theme_map() + labs(fill = "Count", title = "Total Number of Mental Health Facilities",
caption = "N-MHSS") +
scale_fill_distiller(palette = "Spectral") +
theme(text = element_text(size = 10))
#### Number of MHF per cap
data <- nmhss %>%
group_by(state) %>%
dplyr::summarise(state, n = n()) %>%
distinct() %>%
left_join(us_states, by = c("state" = "region")) %>%
left_join(pop, by = c("state"))
ggplot(data, aes(x = long, y = lat,
group = group, fill = n/pop * 100,000)) +
coord_map(projection = "albers", lat0 = 39, lat1 = 45) +
geom_polygon(color = "#8d99ae", size = 0.1) +
theme_map() + labs(fill = "Rate per 100,000", title = "Number of Mental Health Facilities per Capita",
caption = "N-MHSS") +
scale_fill_distiller(palette = "Spectral") +
theme(text = element_text(size = 10))
ggsave("./figs/plot10.png")
### Mental health treatment specialty correlation
pcor <- nmhss %>%
# dplyr::filter(focus == "Mental health treatment") %>%
group_by(state) %>%
dplyr::summarise(TOT = n()) %>%
distinct() %>%
na.omit()
mcor <- brfss %>%
group_by(state) %>%
summarise(per = sum(ifelse(ment14d != "0", 1, 0), na.rm = TRUE)/n()) %>%
distinct()
data <- left_join(pcor, mcor, by = "state")
cat("Number of MHF vs. At Least 1 Bad Mental Health Day Correlation: \n", cor(data$TOT, data$per))
ggplot(data) +
geom_text_repel(aes(x = per, y = TOT, label = str_to_title(state)), size = 2) +
labs(x = "Percent of Respondents who had at Least 1 Bad Mental Health Day",
y = "Number of MHF",
title = "Mental Health Need and Availability",
subtitle = "All Facilities")
## by facility type
drilln(facilitytype) %>%
ggplot() + geom_bar(aes(x = reorder(state, count), y = count, fill = facilitytype),
stat = "identity", position = "stack") +
theme_classic() +
guides(fill = guide_legend(nrow  = 6)) +
theme(legend.position = "bottom", axis.text.x = element_text(angle = 45),
axis.title.x = element_blank()) +
scale_fill_pal(pal2)
psave <- function(path, save = FALSE) {
if (save == TRUE) {
ggsave(path, height = unit(6, "in"), width = units(8, "in"))
} else {
print("Save == FALSE")
}
}
psave("./figs/plot14.png")
psave <- function(path, save = TRUE) {
if (save == TRUE) {
psave(path, height = unit(6, "in"), width = units(8, "in"))
} else {
print("Save == FALSE")
}
}
psave <- function(path, save = FALSE) {
if (save == TRUE) {
psave(path, height = unit(6, "in"), width = units(8, "in"))
} else {
print("Save == FALSE")
}
}
psave("./figs/plot14.png", save = TRUE)
## by facility type
drilln(facilitytype) %>%
ggplot() + geom_bar(aes(x = reorder(state, count), y = count, fill = facilitytype),
stat = "identity", position = "stack") +
theme_classic() +
guides(fill = guide_legend(nrow  = 6)) +
theme(legend.position = "bottom", axis.text.x = element_text(angle = 45),
axis.title.x = element_blank()) +
scale_fill_pal(pal2)
psave("./figs/plot14.png", save = TRUE)
psave <- function(path, save = FALSE) {
if (save == TRUE) {
ggsave(path, height = unit(6, "in"), width = units(8, "in"))
} else {
print("Save == FALSE")
}
}
## by facility type
drilln(facilitytype) %>%
ggplot() + geom_bar(aes(x = reorder(state, count), y = count, fill = facilitytype),
stat = "identity", position = "stack") +
theme_classic() +
guides(fill = guide_legend(nrow  = 6)) +
theme(legend.position = "bottom", axis.text.x = element_text(angle = 45),
axis.title.x = element_blank()) +
scale_fill_pal(pal2)
psave("./figs/plot14.png", save = TRUE)
psave <- function(path, save = FALSE) {
if (save == TRUE) {
ggsave(path, height = unit(6, "in"), width = unit(8, "in"))
} else {
print("Save == FALSE")
}
}
## by facility type
drilln(facilitytype) %>%
ggplot() + geom_bar(aes(x = reorder(state, count), y = count, fill = facilitytype),
stat = "identity", position = "stack") +
theme_classic() +
guides(fill = guide_legend(nrow  = 6)) +
theme(legend.position = "bottom", axis.text.x = element_text(angle = 45),
axis.title.x = element_blank()) +
scale_fill_pal(pal2)
psave("./figs/plot14.png", save = TRUE)
pal <- c("#001219", "#005f73", "#0a9396", "#94d2bd", "#e9d8a6", "#ee9b00", "#ca6702", "#bb3e03", "#CA8D8F", "#ae2012", "#9b2226", "#61252F")
pal2 <- c("#264653", "#287271", "#2a9d8f", "#8ab17d", "#babb74", "#e9c46a", "#efb366", "#f4a261", "#ee8959", "#e76f51", "#DA5231", "#B85146")
cvi_palettes = function(palette, n, type = c("discrete", "continuous")) {
if (missing(n)) {
n = length(palette)
}
type = match.arg(type)
out = switch(type,
continuous = grDevices::colorRampPalette(palette)(n),
discrete = palette[1:n]
)
structure(out, name = "pal", class = "palette")
}
psave("./figs/plot14.png", save = TRUE)
getwd()
getwd() + "."
c(getwd(), "fort")
str_c(getwd(), "./figs/plot14.png")
psave("./figs/plot14.png", save = TRUE)
str_c(getwd(), "./figs/plot14.png")
file.exists(str_c(getwd(), "./figs/plot14.png"))
file.exists("./figs/plot14.png"))
file.exists("./figs/plot14.png")
psave <- function(path, save = FALSE) {
if (save == TRUE) {
ggsave(path, height = unit(6, "in"), width = unit(8, "in"))
print("File saved")
} else {
print("Save == FALSE")
}
}
file.exists("./figs/plot14.png")
psave("./figs/plot14.png", save = TRUE)
ggsave(str_c(getwd(), path), height = unit(6, "in"), width = unit(8, "in"))
psave <- function(path, save = FALSE) {
if (save == TRUE) {
ggsave(str_c(getwd(), path), height = unit(6, "in"), width = unit(8, "in"))
print("File saved")
} else {
print("Save == FALSE")
}
}
psave("./figs/plot14.png", save = TRUE)
psave <- function(path, save = TRUE) {
if (save == TRUE) {
ggsave(str_c(getwd(), path), height = unit(6, "in"), width = unit(8, "in"))
print("File saved")
} else {
print("Save == FALSE")
}
}
p <- brfss %>%
ggplot() +
geom_bar(aes(x = phys14d), fill = "#e76f51", color = "#2B2D42") +
scale_y_continuous(limits = c(0, 300000), labels = comma) +
labs(x = "Phsyical Health", y = "Frequency") +
guides(fill = "none")
m <- brfss %>%
ggplot() +
geom_bar(aes(x = ment14d), fill = "#588157", color = "#2B2D42") +
scale_y_continuous(limits = c(0, 300000), labels = comma) +
labs(x = "Mental Health") +
theme(axis.title.y = element_blank()) +
guides(fill = "none")
title <- ggdraw() +
draw_label(
"Number of Days per Month Respondants \"Had a Bad ____ Day\"",
fontface = 'bold',
x = -0.08,
hjust = -.1,
)
plot_grid(title, plot_grid(p, m, align = "vh"), nrow = 2, rel_heights = c(0.1, 1))
plotsave("./figs/plot1.png")
psave <- function(path, save = TRUE) {
if (save == TRUE) {
ggsave(str_c(getwd(), path), height = unit(6, "in"), width = unit(8, "in"))
print("File saved")
} else {
print("Save == FALSE")
}
}
plotsave("./figs/plot1.png")
psave <- function(path, save = TRUE) {
if (save == TRUE) {
ggsave(path, height = unit(6, "in"), width = unit(8, "in"))
print("File saved")
} else {
print("Save == FALSE")
}
}
psave("./figs/plot3.png")
ggsave("njbaouibewv")
## by facility type
drilln(facilitytype) %>%
ggplot() + geom_bar(aes(x = reorder(state, count), y = count, fill = facilitytype),
stat = "identity", position = "stack") +
theme_classic() +
guides(fill = guide_legend(nrow  = 6)) +
theme(legend.position = "bottom", axis.text.x = element_text(angle = 45),
axis.title.x = element_blank()) +
scale_fill_pal(pal2)
psave("./figs/plot14.png", save = TRUE)
ggsave("njbaouibewv")
## by facility type
drilln(facilitytype) %>%
ggplot() + geom_bar(aes(x = reorder(state, count), y = count, fill = facilitytype),
stat = "identity", position = "stack") +
theme_classic() +
guides(fill = guide_legend(nrow  = 6)) +
theme(legend.position = "bottom", axis.text.x = element_text(angle = 45),
axis.title.x = element_blank()) +
scale_fill_pal(pal2)
ggsave("njbaouibewv")
last_error()
ggsave(".")
## by facility type
drilln(facilitytype) %>%
ggplot() + geom_bar(aes(x = reorder(state, count), y = count, fill = facilitytype),
stat = "identity", position = "stack") +
theme_classic() +
guides(fill = guide_legend(nrow  = 6)) +
theme(legend.position = "bottom", axis.text.x = element_text(angle = 45),
axis.title.x = element_blank()) +
scale_fill_pal(pal2)
ggsave("./figs/plot14.png")
## by facility type
drilln(facilitytype) %>%
ggplot() + geom_bar(aes(x = reorder(state, count), y = count, fill = facilitytype),
stat = "identity", position = "stack") +
theme_classic() +
guides(fill = guide_legend(nrow  = 6)) +
theme(legend.position = "left", axis.text.x = element_text(angle = 45),
axis.title.x = element_blank()) +
scale_fill_pal(pal2)
psave("./figs/plot14.png", save = TRUE)
psave <- function(path, save = FALSE) {
if (save == TRUE) {
ggsave(path, height = unit(6, "in"), width = unit(8, "in"))
print("File saved")
} else {
print("Save == FALSE")
}
}
## by facility type
drilln(facilitytype) %>%
ggplot() + geom_bar(aes(x = reorder(state, count), y = count, fill = facilitytype),
stat = "identity", position = "stack") +
theme_classic() +
guides(fill = guide_legend(nrow  = 6)) +
theme(legend.position = "left", axis.text.x = element_text(angle = 45),
axis.title.x = element_blank()) +
scale_fill_pal(pal2)
## by facility type
drilln(facilitytype) %>%
ggplot() + geom_bar(aes(x = reorder(state, count), y = count, fill = facilitytype),
stat = "identity", position = "stack") +
theme_classic() +
guides(fill = guide_legend(nrow  = 6)) +
theme(legend.position = "bottom", axis.text.x = element_text(angle = 45),
axis.title.x = element_blank()) +
scale_fill_pal(pal2)
